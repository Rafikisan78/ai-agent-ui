<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test Affichage Simple</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .result {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .text-container {
      margin: 15px 0;
      padding: 15px;
      background: #f0fff4;
      border-left: 4px solid #48bb78;
      border-radius: 8px;
    }
    h4 {
      color: #48bb78;
      margin-bottom: 10px;
    }
    .content {
      color: #2d3748;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <h1>Test Affichage du Texte</h1>

  <div class="result">
    <h3>Test 1: Affichage Direct</h3>
    <div class="text-container">
      <h4>üí¨ R√©ponse Texte</h4>
      <div class="content">La capitale de Ha√Øti est **Port-au-Prince**.

C'est la ville la plus peupl√©e du pays et elle est situ√©e sur la c√¥te ouest de l'√Æle d'Hispaniola, au fond du golfe de la Gon√¢ve.</div>
    </div>
  </div>

  <div class="result">
    <h3>Test 2: Affichage via JavaScript (textContent)</h3>
    <div id="test2"></div>
  </div>

  <div class="result">
    <h3>Test 3: Affichage via JavaScript (innerHTML)</h3>
    <div id="test3"></div>
  </div>

  <div class="result">
    <h3>Test 4: Simulation Webhook</h3>
    <button onclick="testWebhook()">Tester le Webhook</button>
    <div id="test4"></div>
  </div>

  <script>
    // Test 2: textContent
    const test2Container = document.getElementById('test2');
    const textContainer2 = document.createElement('div');
    textContainer2.className = 'text-container';

    const header2 = document.createElement('h4');
    header2.textContent = 'üí¨ R√©ponse Texte';

    const content2 = document.createElement('div');
    content2.className = 'content';
    content2.textContent = 'La capitale de Ha√Øti est **Port-au-Prince**.\n\nC\'est la ville la plus peupl√©e du pays et elle est situ√©e sur la c√¥te ouest de l\'√Æle d\'Hispaniola, au fond du golfe de la Gon√¢ve.';

    textContainer2.appendChild(header2);
    textContainer2.appendChild(content2);
    test2Container.appendChild(textContainer2);

    // Test 3: innerHTML
    const test3Container = document.getElementById('test3');
    test3Container.innerHTML = `
      <div class="text-container">
        <h4>üí¨ R√©ponse Texte</h4>
        <div class="content">La capitale de Ha√Øti est **Port-au-Prince**.

C'est la ville la plus peupl√©e du pays et elle est situ√©e sur la c√¥te ouest de l'√Æle d'Hispaniola, au fond du golfe de la Gon√¢ve.</div>
      </div>
    `;

    // Test 4: Simulation Webhook
    async function testWebhook() {
      const test4Container = document.getElementById('test4');
      test4Container.innerHTML = '<p>Chargement...</p>';

      try {
        const response = await fetch('https://n8n.srv766650.hstgr.cloud/webhook/ai-agent-fiable', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: '\\text capitale de Haiti',
            type: 'text'
          })
        });

        const text = await response.text();
        const parsed = JSON.parse(text);
        const data = Array.isArray(parsed) ? parsed[0] : parsed;

        console.log('Donn√©es re√ßues:', data);

        const textResponse = data.content || data.response;

        test4Container.innerHTML = '';
        const textContainer = document.createElement('div');
        textContainer.className = 'text-container';

        const header = document.createElement('h4');
        header.textContent = 'üí¨ R√©ponse Texte (du webhook)';

        const contentDiv = document.createElement('div');
        contentDiv.className = 'content';
        contentDiv.textContent = textResponse;

        textContainer.appendChild(header);
        textContainer.appendChild(contentDiv);
        test4Container.appendChild(textContainer);

        // Ajouter aussi le JSON
        const jsonDiv = document.createElement('pre');
        jsonDiv.style.cssText = 'background: #2d3748; color: #68d391; padding: 10px; border-radius: 4px; overflow-x: auto; margin-top: 10px;';
        jsonDiv.textContent = JSON.stringify(data, null, 2);
        test4Container.appendChild(jsonDiv);

      } catch (error) {
        test4Container.innerHTML = `<p style="color: red;">Erreur: ${error.message}</p>`;
      }
    }
  </script>
</body>
</html>
